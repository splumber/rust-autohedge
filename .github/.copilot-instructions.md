# Copilot Instructions for Rust AutoHedge

## Project Overview
Rust AutoHedge is a high-performance, event-driven automated cryptocurrency trading system built in Rust with multi-exchange support (Alpaca, Binance, Coinbase, Kraken).

## Documentation Organization

### Documentation Structure
All documentation files must be organized in the `docs/` folder with the following structure:

```
docs/
├── INDEX.md                    # Main documentation index
├── TECHNICAL_DESIGN.md         # Technical architecture documentation
├── HFT_PERFORMANCE.md          # High-frequency trading performance docs
├── fixes/                      # Bug fixes and issue resolutions
│   ├── INFINITE_LOOP_FIX_URGENT.md
│   ├── INFINITE_LOOP_COMPLETE_SUMMARY.md
│   ├── NO_TRADE_COOLDOWN.md
│   ├── ORDER_MINIMUM_FIX.md
│   ├── ORDER_VALIDATION_TESTS.md
│   ├── ORPHANED_POSITION_FIX.md
│   ├── ORPHANED_POSITION_QUICKFIX.md
│   ├── POSITION_NOT_FOUND_FIX.md
│   ├── QUANTITY_MISMATCH_FIX.md
│   ├── RESTART_HANDLING_YES.md
│   ├── RESTART_POSITION_HANDLING.md
│   ├── RETRY_ON_ERROR_FIX.md
│   ├── SELL_LOGIC_ANALYSIS.md
│   ├── TAKE_PROFIT_STOP_LOSS_COMPLETE.md
│   └── TESTS.md
└── guides/                     # User guides and tutorials
    ├── USER_GUIDE.md
    ├── POSITION_MANAGEMENT_GUIDE.md
    ├── REFACTORING_PLAN.md
    ├── REFACTORING_QUICKSTART.md
    └── REFACTORING_SUMMARY.md
```

### Documentation Placement Rules

#### 1. **Fixes Documentation** (`docs/fixes/`)
Place documentation in `docs/fixes/` when it describes:
- Bug fixes and their resolutions
- Issue investigations and root cause analysis
- Specific problem solutions
- Test documentation for fixes
- Performance fixes
- Error handling improvements

**Naming Convention**: 
- Use UPPERCASE with underscores (e.g., `INFINITE_LOOP_FIX.md`)
- Include descriptive keywords (FIX, ANALYSIS, TESTS, COMPLETE, SUMMARY)
- Examples: `ORDER_MINIMUM_FIX.md`, `RETRY_ON_ERROR_FIX.md`

#### 2. **Guides Documentation** (`docs/guides/`)
Place documentation in `docs/guides/` when it describes:
- User guides and tutorials
- How-to documentation
- Best practices
- Refactoring plans and strategies
- Feature usage guides
- Development workflows

**Naming Convention**:
- Use UPPERCASE with underscores (e.g., `USER_GUIDE.md`)
- Include keywords (GUIDE, PLAN, SUMMARY, QUICKSTART)
- Examples: `POSITION_MANAGEMENT_GUIDE.md`, `REFACTORING_PLAN.md`

#### 3. **Root Documentation** (`docs/`)
Keep in root `docs/` folder:
- `INDEX.md` - Main documentation index
- `TECHNICAL_DESIGN.md` - Overall technical architecture
- `HFT_PERFORMANCE.md` - Performance metrics and benchmarks
- High-level architectural documents

### When Creating New Documentation

**ALWAYS**:
1. Determine if it's a fix, guide, or high-level doc
2. Place it in the appropriate folder (`docs/fixes/`, `docs/guides/`, or `docs/`)
3. Use consistent naming conventions (UPPERCASE with underscores)
4. Update `docs/INDEX.md` with a reference to the new document
5. Include clear headings and sections
6. Add dates or timestamps for time-sensitive information

**NEVER**:
- Place documentation files in the project root (unless they are standard files like README.md, CHANGELOG.md)
- Mix fix documentation with guides
- Use inconsistent naming conventions
- Create documentation without categorizing it

### Moving Existing Documentation

When you encounter documentation files in the wrong location:
1. Analyze the content to determine the correct category
2. Move to `docs/fixes/` or `docs/guides/` as appropriate
3. Update any references or links to the moved file
4. Update `docs/INDEX.md` to reflect the new location

### Documentation Content Guidelines

#### For Fixes (`docs/fixes/`)
- **Problem Statement**: Clearly describe the issue
- **Root Cause**: Explain what caused the problem
- **Solution**: Detail the fix implementation
- **Testing**: Describe how the fix was validated
- **Impact**: Note any side effects or related changes

#### For Guides (`docs/guides/`)
- **Purpose**: What the guide teaches
- **Prerequisites**: What users need to know first
- **Step-by-Step**: Clear, numbered instructions
- **Examples**: Code examples and use cases
- **References**: Links to related documentation

## Code Style and Conventions

### Rust Code
- Always run `cargo fmt` after making code changes
- Follow Rust naming conventions (snake_case for functions/variables, PascalCase for types)
- Use meaningful variable names
- Add comments for complex logic
- Write tests for new functionality

### Project-Specific Conventions
- Event-driven architecture: Use the event bus for component communication
- Error handling: Use the custom `Error` type in `src/error.rs`
- Async operations: Use `tokio` runtime
- Configuration: All config in `config.yaml`, validated by `src/config.rs`

## Testing
- Unit tests: In same file with `#[cfg(test)]`
- Integration tests: In `tests/` directory
- Run tests with `cargo test`
- Maintain >85% code coverage

## Exchange Integration
When adding exchange support:
1. Implement traits in `src/exchange/traits.rs`
2. Add exchange module in `src/exchange/`
3. Update factory in `src/exchange/factory.rs`
4. Add WebSocket support in `src/exchange/ws.rs`
5. Document in `docs/guides/`

## Performance Considerations
- This is a high-frequency trading system (4 orders/second per symbol)
- Optimize for latency-sensitive operations
- Use async/await for I/O operations
- Minimize allocations in hot paths
- Profile before optimizing

## Security
- Never commit API keys or secrets
- Use environment variables or `config.yaml` (gitignored)
- Validate all user inputs
- Sanitize data from external APIs

---

**Remember**: Keep documentation organized, code formatted, and tests passing. When in doubt about where to place documentation, analyze its primary purpose (fix vs. guide vs. architecture) and place accordingly.

